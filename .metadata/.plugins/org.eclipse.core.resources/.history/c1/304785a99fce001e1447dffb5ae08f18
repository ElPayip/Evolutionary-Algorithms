package modelo;

import java.util.Comparator;
import java.util.List;
import java.util.Random;

import modelo.cruce.Cruce;
import modelo.fitness.Fitness;
import modelo.individuo.Individuo;
import modelo.seleccion.Seleccion;
import utils.Pair;

public abstract class AlgGenetico<T> {

	protected List<Individuo<T>> poblacion;
	protected Individuo<T> mejor;
	protected Cruce<T> cruce;
	protected Seleccion seleccion;
	protected Fitness<T> fitness;
	
	protected int nGeneraciones;
	protected double probCruce;
	
	public AlgGenetico() {
		reset();
	}
	
	public void reset() {
		
	}
	
	public Individuo<T> ejecutar() {
		initPoblacion();
		evaluar();
		for (int i = 0; i < nGeneraciones; ++i)
			ejecutarGeneracion();
		return mejor;
	}
	
	private void ejecutarGeneracion() {
		seleccionar();
		cruzar();
		mutar();
		evaluar();
	}
	
	protected void seleccionar() {
		seleccion.seleccionar(poblacion);
	}
	
	protected void cruzar() {
		Random rnd = new Random();
		int pareja = -1;
		for (int i = 0; i < poblacion.size(); ++i)
			if (rnd.nextDouble() < probCruce) {
				
				if (pareja < 0)
					pareja = i;
				else {	// Reemplazo de progenitores
					Pair<Individuo<T>,Individuo<T>> hijos = poblacion.get(pareja).cruzar(poblacion.get(i), cruce);
					poblacion.set(pareja, hijos.getFirst());
					poblacion.set(i, hijos.getSecond());
					pareja = -1;
				}
			}
	}
	
	protected void evaluar() {
		for (Individuo<T> i : poblacion)
			fitness.eval(i);
		
		poblacion.sort(new Comparator<Individuo<T>>() {

			@Override
			public int compare(Object o1, Object o2) {
				// TODO Auto-generated method stub
				return 0;
			}
			
		});
	}
	
	protected void mutar() {
		
	}
	
	protected abstract void initPoblacion();
}
